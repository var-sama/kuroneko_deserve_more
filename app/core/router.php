<?php
namespace App\core;

class router
{ 
    private array $routes=[];
    public function add(string $method, string $uri, string $controller, string $function): void{
        $this->routes[]=[
            'method'=>$method,
            'uri'=>$uri,
            'controller'=>$controller,
            'function'=>$function
        ];        
    }
    public function run(): void
    {
        $method = $_SERVER['REQUEST_METHOD'];
        $uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);

        foreach($this->routers as $router){
            $pattern = str_replace(
                '{id}','([0-9]+)',$router['uri']
            );
            $pattern= "#^ . $pattern . $#";
            if(preg_match($pattern, $uri, $matches)){
                 require_once './app/controllers/' . $route['controller'] . '.php';
                 array_shift($matches);
                 $controllerClass = 'App\\controllers\\' . $route['controller'];
                 $controller = new $controllerClass();

                 $function = $route['function'];
                 $controller->$function(...array_slice($matches,1));
            }
        }
        // echo"{$method} {$uri}";
        if($method == 'GET' && $uri =='/students'){
            require_once './app/controllers/StudentsController.php';
            $controller = new \App\controllers\StudentsController();
            $controller->index();
            return;
        } 
        if($method == 'GET' && $uri =='/students/create'){
            require_once './app/controllers/StudentsController.php';
            $controller = new \App\controllers\StudentsController();
            $controller->create();
            return;
        }
        http_response_code(404);
        echo "<h1> - page not found</h1>";
    }

}
?>